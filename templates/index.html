<!DOCTYPE html>
<html>
<head>
  <title>{{ title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="red-bg">
  <div class="fog-overlay"></div>
  <h1>{{ title }}</h1>
  <p>{{ caption }}</p>

  <!-- ðŸŽµ Ritual Audio Element (no controls, plays on button click) -->
  <audio id="ritual-audio" preload="auto">
    <source id="audio-source" src="" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <!-- ðŸ§  Selection Buttons with Audio URLs -->
  <form method="POST" action="/step">
    <button name="choice" value="option1"
            data-audio="{{ url_for('static', filename='audio/golden-haze-01.mp3') }}">
      Option 1
    </button>
    <button name="choice" value="option2"
            data-audio="{{ url_for('static', filename='audio/stutters-in-silence-01.mp3') }}">
      Option 2
    </button>
  </form>

  <!-- ðŸ§ª Ritual Script -->
  <script>
    const audio = document.getElementById('ritual-audio');
    const source = document.getElementById('audio-source');
    const optionButtons = document.querySelectorAll('button[name="choice"]');

    optionButtons.forEach(button => {
      button.addEventListener('click', event => {
        event.preventDefault();

        const newSrc = event.target.dataset.audio;
        source.src = newSrc;
        audio.load();

        // Try to play and wait for it to start
        audio.play().then(() => {
          setTimeout(() => {
            event.target.form.submit();
          }, 1000); // Delay to let audio begin
        }).catch(error => {
          console.error("Audio playback failed:", error);
          event.target.form.submit(); // Fallback if audio fails
        });
      });
    });
  </script>
</body>
</html>

